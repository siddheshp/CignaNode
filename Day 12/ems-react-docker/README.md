# Employee Management System - React 19 with Vite and Okta Authentication

A full-featured Employee Management System built with React 19, Vite, Bootstrap, and Okta authentication. This application provides CRUD (Create, Read, Update, Delete) operations for managing employee records with role-based access control.

## Features

- âœ… View all employees in a table (No authentication required)
- âœ… Add new employees (Requires Admin role)
- âœ… Edit existing employee details (Requires Admin role)
- âœ… Delete employees (Requires Admin role)
- âœ… Okta authentication with OAuth 2.0 + PKCE
- âœ… Role-based access control (Admin and Employee roles)
- âœ… Form validation
- âœ… Responsive design with Bootstrap 5
- âœ… Navigation bar with Login/Logout
- âœ… API integration with JWT token authentication

## Employee Model

```javascript
{
  id: number,           // Auto-generated by backend
  name: string,
  email: string,
  salary: number,
  dateOfBirth: string,  // Date in YYYY-MM-DD format
  mobileNumber: number,
  departmentId: number
}
```

## Authentication & Authorization

- **Public Access**: Employee List (view only)
- **Admin Role Required**: Add, Edit, Delete operations
- **Authentication Provider**: Okta with OAuth 2.0 + PKCE flow

## Prerequisites

Before you begin, ensure you have the following:
- Node.js (v18 or higher)
- npm (v9 or higher)
- Backend API running on `http://localhost:3000`
- **Okta account with application configured** (Contact your administrator)
- **Podman Desktop installed** (for containerized deployment)

## Quick Start for Students

### For Local Development

1. **Get your Okta credentials from your instructor**
   - Okta Domain (e.g., `https://integrator-1649836.okta.com`)
   - Client ID

2. **Configure the application**
   ```bash
   # Copy the example file
   cp .env.example .env
   
   # Edit .env and fill in your credentials
   # VITE_OKTA_DOMAIN=https://your-okta-domain.okta.com
   # VITE_OKTA_CLIENT_ID=your-client-id-here
   ```

3. **Install and run**
   ```bash
   npm install
   npm run dev
   ```

4. **Open browser** â†’ `http://localhost:5173`

---

### For Container Deployment (Podman)

1. **Get your Okta credentials from your instructor**

2. **Build the container image**
   ```bash
   podman build -t ems-frontend .
   ```

3. **Run the container** (replace with your actual Okta values)
   ```bash
   podman run -d \
     --name ems-frontend \
     -p 8080:80 \
     -e VITE_OKTA_DOMAIN=https://integrator-1649836.okta.com \
     -e VITE_OKTA_CLIENT_ID=0oaxhzqctrCKvudI8697 \
     -e VITE_OKTA_DISABLE_HTTPS_CHECK=false \
     -e VITE_API_BASE_URL=http://localhost:3000/api \
     ems-frontend
   ```

4. **Access the app** â†’ `http://localhost:8080`

5. **View logs** (if something goes wrong)
   ```bash
   podman logs ems-frontend
   ```

6. **Stop the container**
   ```bash
   podman stop ems-frontend
   podman rm ems-frontend
   ```

---

### Running Frontend + Backend Together

If you have both containers:

```bash
# Create a network
podman network create ems-network

# Start backend
podman run -d --name ems-backend --network ems-network -p 3000:3000 ems-backend

# Start frontend (connected to backend)
podman run -d \
  --name ems-frontend \
  --network ems-network \
  -p 8080:80 \
  -e VITE_OKTA_DOMAIN=https://your-domain.okta.com \
  -e VITE_OKTA_CLIENT_ID=your-client-id \
  -e VITE_OKTA_DISABLE_HTTPS_CHECK=false \
  -e VITE_API_BASE_URL=http://localhost:3000/api \
  ems-frontend
```

---

## Troubleshooting

**Problem: "Issuer must be a valid URL"**
- âœ… Make sure you provided all `-e` environment variables when running the container
- âœ… Check that your Okta domain is correct (no typos)

**Problem: Can't connect to backend API**
- âœ… Ensure backend container is running: `podman ps`
- âœ… Check backend is on port 3000: `curl http://localhost:3000/api/employees`

**Problem: Need to rebuild**
```bash
podman stop ems-frontend
podman rm ems-frontend
podman build -t ems-frontend .
# Then run again
```

---

## Quick Start (Original Documentation)

### Option 1: Development Mode

1. **Clone or navigate to the project directory**
   ```bash
   cd ems-react-okta
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Configure environment variables**
   ```bash
   # Copy the example env file
   cp .env.example .env
   
   # Edit .env and add your Okta configuration and API URL
   # VITE_OKTA_DOMAIN=https://your-okta-domain.okta.com
   # VITE_OKTA_CLIENT_ID=your-client-id
   # VITE_API_BASE_URL=http://localhost:3000/api
   ```

4. **Start the development server**
   ```bash
   npm run dev
   ```

5. **Open your browser**
   - Navigate to `http://localhost:5173`
   - Ensure your backend API is running on `http://localhost:3000`
   - Click "Login" to authenticate with Okta

### Option 2: Using Podman Containers (Advanced)

#### Prerequisites for Container Deployment
- Podman Desktop installed and running
- Backend API container image available

#### Container Architecture

This React app is containerized with:
- **Nginx web server** - Serves the built React app (production-ready)
- **Runtime configuration** - Environment variables injected at container startup
- **Multi-stage build** - Optimized image size

#### How It Works

1. **Build Stage**: Compiles React app into static files (HTML, CSS, JS)
2. **Runtime Stage**: Nginx serves these files
3. **Startup Script**: `docker-entrypoint.sh` injects your Okta config when container starts
4. **Config File**: `public/config.js` is replaced with actual values at runtime

This means **one image works everywhere** - just change environment variables!

#### Steps to Run with Podman

1. **Build the frontend container**
   ```bash
   podman build -t ems-react-frontend:latest .
   ```

2. **Run the container** (update with your Okta credentials)
   ```bash
   podman run -d \
     --name ems-react-frontend \
     -p 8080:80 \
     -e VITE_OKTA_DOMAIN=https://your-okta-domain.okta.com \
     -e VITE_OKTA_CLIENT_ID=your-client-id-here \
     -e VITE_OKTA_DISABLE_HTTPS_CHECK=false \
     -e VITE_API_BASE_URL=http://localhost:3000/api \
     ems-react-frontend:latest
   ```
   
   **Note**: All `-e` flags are **required**. The container cannot start without them.

3. **Or use Podman Compose**
   
   Edit `docker-compose.yml` and update the environment variables:
   ```yaml
   environment:
     - VITE_OKTA_DOMAIN=https://your-okta-domain.okta.com
     - VITE_OKTA_CLIENT_ID=your-client-id-here
     - VITE_OKTA_DISABLE_HTTPS_CHECK=false
     - VITE_API_BASE_URL=http://localhost:3000/api
   ```
   
   Then run:
   ```bash
   podman-compose up -d
````
4. **Access the application**
   - Frontend: `http://localhost:8080`
   - Backend API: `http://localhost:3000`

5. **View logs** (if something goes wrong)
   ```bash
   podman logs -f ems-react-frontend
   ```

6. **Stop containers**
   ```bash
   podman-compose down
   # Or manually: podman stop ems-react-frontend
   ```

#### Understanding the Container Files

**`Dockerfile`** - Instructions to build the container image
- Stage 1: Builds the React app with Node.js
- Stage 2: Serves it with Nginx web server

**`nginx.conf`** - Web server configuration
- Handles React Router (SPA routing)
- Serves static files efficiently

**`docker-entrypoint.sh`** - Startup script
- Runs when container starts
- Injects your environment variables into the app

**`public/config.js`** - Runtime configuration template
- Placeholder for Okta credentials
- Gets replaced with actual values at startup

#### Why This Approach?

**Problem**: Vite embeds environment variables at build time. One image = one configuration.

**Solution**: Runtime configuration lets you:
- Build once, deploy anywhere
- Use same image for dev, test, production
- Just change environment variables when running

#### Common Questions

**Q: Why not just use .env file?**  
A: .env works for development, but containers need runtime configuration to be portable.

**Q: Why Nginx instead of `npm run dev`?**  
A: Nginx is production-grade, lightweight (~25MB vs ~150MB), and much faster for serving static files.

**Q: Can I skip the environment variables?**  
A: No. The container needs them to configure Okta. Without them, you'll get "Issuer must be a valid URL" error.

## Available Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run preview` - Preview production build

---

## Step-by-Step Guide to Recreate This App

This comprehensive guide will help you build this application from scratch with Okta authentication.

### Step 1: Create Project with Vite

1. **Open terminal and create a new Vite project**
   ```bash
   npm create vite@latest ems-react-okta -- --template react
   ```

2. **Navigate to project directory**
   ```bash
   cd ems-react-okta
   ```

3. **Install dependencies**
   ```bash
   npm install
   ```

### Step 2: Install Required Packages

Install all necessary packages including Okta:
```bash
npm install bootstrap@5.3.3 react-router-dom@6.22.0
npm install @okta/okta-auth-js@^7.5.0 @okta/okta-react@^6.10.0
```

3. **Configure Environment Variables**

1. **Create `.env.example` file in project root**
   ```env
   # Okta Configuration
   VITE_OKTA_DOMAIN=https://your-okta-domain.okta.com
   VITE_OKTA_CLIENT_ID=your-client-id-here
   VITE_OKTA_DISABLE_HTTPS_CHECK=false
   
   # API Base URL
   VITE_API_BASE_URL=http://localhost:3000/api
   ```

2. **Copy to create your actual `.env` file**
   ```bash
   cp .env.example .env
   ```

3. **Edit `.env` with your actual Okta credentials and API URL**
   - Replace `your-okta-domain.okta.com` with your Okta domain
   - Replace `your-client-id-here` with your application's Client ID
   - Update `VITE_API_BASE_URL` if your backend runs on a different URL
   
4. **Update `.gitignore` to exclude `.env`**
   ```
   # Environment variables
   .env
   ```

### Step 4: Project Structure Setup

Create the following folder structure:
```
ems-react-okta/
â”œâ”€â”€ public/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ NavBar.jsx
â”‚   â”‚   â”œâ”€â”€ NavBar.css
â”‚   â”‚   â”œâ”€â”€ EmployeeList.jsx
â”‚   â”‚   â”œâ”€â”€ EmployeeList.css
â”‚   â”‚   â”œâ”€â”€ EmployeeForm.jsx
â”‚   â”‚   â”œâ”€â”€ EmployeeForm.css
â”‚   â”‚   â””â”€â”€ SecureRoute.jsx
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ employeeService.js
â”‚   â”œâ”€â”€ oktaConfig.js
â”‚   â”œâ”€â”€ App.jsx
â”‚   â”œâ”€â”€ App.css
â”‚   â”œâ”€â”€ main.jsx
â”‚   â””â”€â”€ index.css
â”œâ”€â”€ .env
â”œâ”€â”€ .env.example
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.js
â””â”€â”€ package.json
```

### Step 5: Create Okta Configuration

Create `src/oktaConfig.js`:
```javascript
// Okta configuration
export const oktaConfig = {
  issuer: `${import.meta.env.VITE_OKTA_DOMAIN}/oauth2/default`,
  clientId: import.meta.env.VITE_OKTA_CLIENT_ID,
  redirectUri: window.location.origin + '/login/callback',
  scopes: ['openid', 'profile', 'email'],
  pkce: true,
  disableHttpsCheck: import.meta.env.VITE_OKTA_DISABLE_HTTPS_CHECK === 'true',
};
```

**Note**: This configuration uses PKCE (Proof Key for Code Exchange) which is the recommended OAuth 2.0 flow for SPAs.

### Step 6: Setup Okta Security Provider

Update `src/main.jsx` to wrap app with Okta Security provider:
```javascript
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { Security } from '@okta/okta-react';
import { OktaAuth, toRelativeUrl } from '@okta/okta-auth-js';
import App from './App.jsx';
import { oktaConfig } from './oktaConfig.js';
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap/dist/js/bootstrap.bundle.min.js';
import './index.css';

const oktaAuth = new OktaAuth(oktaConfig);

const restoreOriginalUri = (_oktaAuth, originalUri) => {
  window.location.replace(toRelativeUrl(originalUri || '/', window.location.origin));
};

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <Security oktaAuth={oktaAuth} restoreOriginalUri={restoreOriginalUri}>
        <App />
      </Security>
    </BrowserRouter>
  </React.StrictMode>
);
```

### Step 7: Create Authentication Helper Components

Create `src/components/SecureRoute.jsx`:
```javascript
import { useEffect } from 'react';
import { useOktaAuth } from '@okta/okta-react';
import { toRelativeUrl } from '@okta/okta-auth-js';

export const RequireAuth = ({ children }) => {
  const { oktaAuth, authState } = useOktaAuth();

  useEffect(() => {
    if (!authState) {
      return;
    }

    if (!authState.isAuthenticated) {
      const originalUri = toRelativeUrl(window.location.href, window.location.origin);
      oktaAuth.setOriginalUri(originalUri);
      oktaAuth.signInWithRedirect();
    }
  }, [oktaAuth, authState]);

  if (!authState || !authState.isAuthenticated) {
    return <div>Loading...</div>;
  }

  return children;
};

export const RequireAdmin = ({ children }) => {
  const { oktaAuth, authState } = useOktaAuth();

  useEffect(() => {
    if (!authState) {
      return;
    }

    if (!authState.isAuthenticated) {
      const originalUri = toRelativeUrl(window.location.href, window.location.origin);
      oktaAuth.setOriginalUri(originalUri);
      oktaAuth.signInWithRedirect();
    }
  }, [oktaAuth, authState]);

  if (!authState) {
    return <div>Loading...</div>;
  }

  if (!authState.isAuthenticated) {
    return <div>Loading...</div>;
  }

  const userGroups = authState.accessToken?.claims?.groups || [];
  const isAdmin = userGroups.includes('admin');

  console.log('RequireAdmin - Auth State:', authState);
  console.log('RequireAdmin - Access Token Claims:', authState.accessToken?.claims);
  console.log('RequireAdmin - Groups:', userGroups);
  console.log('RequireAdmin - Is Admin:', isAdmin);

  if (!isAdmin) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger" role="alert">
          <h4 className="alert-heading">Access Denied</h4>
          <p>You do not have permission to access this resource. Admin role is required.</p>
          <hr />
          <p className="mb-0">Please contact your administrator if you believe this is an error.</p>
        </div>
      </div>
    );
  }

  return children;
};
```

**Key Points**:
- `RequireAuth`: Redirects to Okta login if user is not authenticated
- `RequireAdmin`: Checks for 'Admin' group membership in Okta (from accessToken.claims.groups)
- Uses Okta's `authState` to track authentication status
- Includes debug console.log statements for troubleshooting

### Step 7.5: Create Authentication Utility Functions

Create `src/utils/auth.js` for reusable auth helpers:
```javascript
export const hasAdminRole = (authState) => {
  return authState?.isAuthenticated && 
    (authState.accessToken?.claims?.groups || []).includes('admin');
};

export const isAuthenticated = (authState) => authState?.isAuthenticated || false;

export const getAccessToken = (authState) => authState?.accessToken?.accessToken;

export const getUserInfo = (authState) => 
  authState?.isAuthenticated && authState.idToken ? {
    name: authState.idToken.claims.name,
    email: authState.idToken.claims.email,
    groups: authState.accessToken?.claims.groups || [],
  } : null;
```

**Key Features**:
- Concise helper functions for authentication checks
- Role-based access control via `hasAdminRole`
- Safe null checking with optional chaining
- Returns user information from token claims

### Step 8: Project Structure Setup
â”‚   â”‚   â”œâ”€â”€ NavBar.jsx
â”‚   â”‚   â”œâ”€â”€ NavBar.css
â”‚   â”‚   â”œâ”€â”€ EmployeeList.jsx
â”‚   â”‚   â”œâ”€â”€ EmployeeList.css
â”‚   â”‚   â”œâ”€â”€ EmployeeForm.jsx
â”‚   â”‚   â””â”€â”€ EmployeeForm.css
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ employeeService.js
â”‚   â”œâ”€â”€ App.jsx
â”‚   â”œâ”€â”€ App.css
â”‚   â”œâ”€â”€ main.jsx
â”‚   â””â”€â”€ index.css
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.js
â””â”€â”€ package.json
```

### Step 4: Configure Vite

Update `vite.config.js`:
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173
  }
})
```

### Step 8: Create Employee Service with Auth Support

Create `src/services/employeeService.js`:
```javascript
const API_BASE_URL = 'http://localhost:3000/api/employees';

const getAuthHeaders = (accessToken) => ({
  'Content-Type': 'application/json',
  ...(accessToken && { Authorization: `Bearer ${accessToken}` }),
});

const handleResponse = async (response) => {
  if (!response.ok) {
    if (response.status === 401) throw new Error('Unauthorized: Please log in');
    if (response.status === 403) throw new Error('Forbidden: Admin role required');
    throw new Error(`Failed: ${response.statusText}`);
  }
  return response.json();
};

export const getAllEmployees = async () => {
  try {
    return await handleResponse(await fetch(API_BASE_URL));
  } catch (error) {
    console.error('Error fetching employees:', error);
    throw error;
  }
};

export const getEmployeeById = async (id) => {
  try {
    return await handleResponse(await fetch(`${API_BASE_URL}/${id}`));
  } catch (error) {
    console.error('Error fetching employee:', error);
    throw error;
  }
};

export const createEmployee = async (employeeData, accessToken) => {
  try {
    return await handleResponse(await fetch(API_BASE_URL, {
      method: 'POST',
      headers: getAuthHeaders(accessToken),
      body: JSON.stringify(employeeData),
    }));
  } catch (error) {
    console.error('Error creating employee:', error);
    throw error;
  }
};

export const updateEmployee = async (id, employeeData, accessToken) => {
  try {
    return await handleResponse(await fetch(`${API_BASE_URL}/${id}`, {
      method: 'PUT',
      headers: getAuthHeaders(accessToken),
      body: JSON.stringify(employeeData),
    }));
  } catch (error) {
    console.error('Error updating employee:', error);
    throw error;
  }
};

export const deleteEmployee = async (id, accessToken) => {
  try {
    return await handleResponse(await fetch(`${API_BASE_URL}/${id}`, {
      method: 'DELETE',
      headers: getAuthHeaders(accessToken),
    }));
  } catch (error) {
    console.error('Error deleting employee:', error);
    throw error;
  }
};

export default {
  getAllEmployees,
  getEmployeeById,
  createEmployee,
  updateEmployee,
  deleteEmployee,
};
```

**Key Changes**:
- All CUD operations (Create, Update, Delete) now accept `accessToken` parameter
- Authorization header is added when token is provided using spread operator
- Consolidated error handling with `handleResponse` helper function
- Proper error handling for 401 (Unauthorized) and 403 (Forbidden)
- Exports default object with all service functions
- Concise code using modern JavaScript patterns

### Step 9: Create NavBar with Login/Logout

```javascript
const API_BASE_URL = 'http://localhost:3000/api/employees';

// Get all employees
export const getAllEmployees = async () => {
  try {
    const response = await fetch(API_BASE_URL);
    if (!response.ok) {
      throw new Error('Failed to fetch employees');
    }
    return await response.json();
  } catch (error) {
    console.error('Error fetching employees:', error);
    throw error;
  }
};

// Get employee by ID
export const getEmployeeById = async (id) => {
  try {
    const response = await fetch(`${API_BASE_URL}/${id}`);
    if (!response.ok) {
      throw new Error('Failed to fetch employee');
    }
    return await response.json();
  } catch (error) {
    console.error('Error fetching employee:', error);
    throw error;
  }
};

// Create new employee
export const createEmployee = async (employeeData) => {
  try {
    const response = await fetch(API_BASE_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(employeeData),
    });
    if (!response.ok) {
      throw new Error('Failed to create employee');
    }
    return await response.json();
  } catch (error) {
    console.error('Error creating employee:', error);
    throw error;
  }
};

// Update employee
export const updateEmployee = async (id, employeeData) => {
  try {
    const response = await fetch(`${API_BASE_URL}/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(employeeData),
    });
    if (!response.ok) {
      throw new Error('Failed to update employee');
    }
    return await response.json();
  } catch (error) {
    console.error('Error updating employee:', error);
    throw error;
  }
};

// Delete employee
export const deleteEmployee = async (id) => {
  try {
    const response = await fetch(`${API_BASE_URL}/${id}`, {
      method: 'DELETE',
    });
    if (!response.ok) {
      throw new Error('Failed to delete employee');
    }
    return await response.json();
  } catch (error) {
    console.error('Error deleting employee:', error);
    throw error;
  }
};
```

### Step 9: Create NavBar with Login/Logout

Create `src/components/NavBar.jsx`:
```javascript
import React from 'react';
import { Link } from 'react-router-dom';
import { useOktaAuth } from '@okta/okta-react';
import './NavBar.css';

const NavBar = () => {
  const { oktaAuth, authState } = useOktaAuth();

  if (!authState) return null;

  return (
    <nav className="navbar navbar-expand-lg navbar-dark bg-primary">
      <div className="container-fluid">
        <Link className="navbar-brand" to="/">
          Employee Management System
        </Link>
        <button
          className="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span className="navbar-toggler-icon"></span>
        </button>
        <div className="collapse navbar-collapse" id="navbarNav">
          <ul className="navbar-nav ms-auto">
            <li className="nav-item">
              <Link className="nav-link" to="/">
                Employee List
              </Link>
            </li>
            {authState.isAuthenticated && (
              <li className="nav-item">
                <Link className="nav-link" to="/add">
                  Add Employee
                </Link>
              </li>
            )}
            {authState.isAuthenticated ? (
              <>
                <li className="nav-item">
                  <span className="nav-link text-white">
                    Hello, {authState.idToken?.claims?.name || 'User'}
                  </span>
                </li>
                <li className="nav-item">
                  <button className="btn btn-outline-light nav-link" onClick={() => oktaAuth.signOut()}>
                    Logout
                  </button>
                </li>
              </>
            ) : (
              <li className="nav-item">
                <button className="btn btn-outline-light nav-link" onClick={() => oktaAuth.signInWithRedirect()}>
                  Login
                </button>
              </li>
            )}
          </ul>
        </div>
      </div>
    </nav>
  );
};

export default NavBar;
```

**Key Features**:
- Uses `useOktaAuth` hook to access authentication state
- Conditionally shows Login/Logout buttons
- Displays user's name when authenticated
- Shows "Add Employee" link only when authenticated
- Inline handlers for sign-in and sign-out (no separate functions)
- Returns null early if authState not loaded

Create `src/components/NavBar.css`:>
                Employee List
              </Link>
            </li>
            <li className="nav-item">
              <Link className="nav-link" to="/add">
                Add Employee
              </Link>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  );
};

export default NavBar;
```

Create `src/components/NavBar.css`:
```css
.navbar-brand {
  font-weight: bold;
  font-size: 1.5rem;
}

.nav-link {
  font-size: 1.1rem;
  margin: 0 10px;
  transition: all 0.3s ease;
}

.nav-link:hover {
  transform: scale(1.05);
}
```

### Step 7: Create EmployeeList Component

Create `src/components/EmployeeList.jsx`:
```javascript
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { getAllEmployees, deleteEmployee } from '../services/employeeService';
import './EmployeeList.css';

const EmployeeList = () => {
  const [employees, setEmployees] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const navigate = useNavigate();

  useEffect(() => {
    fetchEmployees();
  }, []);

  const fetchEmployees = async () => {
    try {
      setLoading(true);
      const data = await getAllEmployees();
      setEmployees(data);
      setError(null);
    } catch (err) {
      setError('Failed to load employees. Please make sure the API server is running.');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (window.confirm('Are you sure you want to delete this employee?')) {
      try {
        await deleteEmployee(id);
        setEmployees(employees.filter(emp => emp.id !== id));
        alert('Employee deleted successfully!');
      } catch (err) {
        alert('Failed to delete employee');
        console.error(err);
      }
    }
  };

  const handleEdit = (id) => {
    navigate(`/edit/${id}`);
  };

  if (loading) {
    return (
      <div className="container mt-5">
        <div className="text-center">
          <div className="spinner-border text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger" role="alert">
          {error}
        </div>
      </div>
    );
  }

  return (
    <div className="container mt-4">
      <h2 className="mb-4">Employee List</h2>
      
      {employees.length === 0 ? (
        <div className="alert alert-info">
          No employees found. Click "Add Employee" to create one.
        </div>
      ) : (
        <div className="table-responsive">
          <table className="table table-striped table-hover">
            <thead className="table-dark">
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Salary</th>
                <th>Date of Birth</th>
                <th>Mobile Number</th>
                <th>Department ID</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {employees.map((employee) => (
                <tr key={employee.id}>
                  <td>{employee.id}</td>
                  <td>{employee.name}</td>
                  <td>{employee.email}</td>
                  <td>${employee.salary.toLocaleString()}</td>
                  <td>{new Date(employee.dateOfBirth).toLocaleDateString()}</td>
                  <td>{employee.mobileNumber}</td>
                  <td>{employee.departmentId}</td>
                  <td>
                    <button
                      className="btn btn-sm btn-warning me-2"
                      onClick={() => handleEdit(employee.id)}
                    >
                      Edit
                    </button>
                    <button
                      className="btn btn-sm btn-danger"
                      onClick={() => handleDelete(employee.id)}
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
};

export default EmployeeList;
```

Create `src/components/EmployeeList.css`:
```css
.table-responsive {
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  overflow: hidden;
}

.table {
  margin-bottom: 0;
}

.table thead th {
  border: none;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.9rem;
}

.table tbody tr {
  transition: all 0.3s ease;
}

.table tbody tr:hover {
  background-color: #f8f9fa;
  transform: scale(1.01);
}

.btn {
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}
```

### Step 8: Create EmployeeForm Component

Create `src/components/EmployeeForm.jsx`:
```javascript
import React, { useState, useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import { createEmployee, updateEmployee, getEmployeeById } from '../services/employeeService';
import './EmployeeForm.css';

const EmployeeForm = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const isEditMode = Boolean(id);

  const [formData, setFormData] = useState({
    name: '',
    email: '',
    salary: '',
    dateOfBirth: '',
    mobileNumber: '',
    departmentId: ''
  });

  const [loading, setLoading] = useState(false);
  const [errors, setErrors] = useState({});

  useEffect(() => {
    if (isEditMode) {
      fetchEmployee();
    }
  }, [id]);

  const fetchEmployee = async () => {
    try {
      setLoading(true);
      const employee = await getEmployeeById(id);
      const formattedDate = employee.dateOfBirth 
        ? new Date(employee.dateOfBirth).toISOString().split('T')[0] 
        : '';
      
      setFormData({
        name: employee.name || '',
        email: employee.email || '',
        salary: employee.salary || '',
        dateOfBirth: formattedDate,
        mobileNumber: employee.mobileNumber || '',
        departmentId: employee.departmentId || ''
      });
    } catch (err) {
      alert('Failed to load employee details');
      navigate('/');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData({
      ...formData,
      [name]: value
    });
    if (errors[name]) {
      setErrors({
        ...errors,
        [name]: ''
      });
    }
  };

  const validateForm = () => {
    const newErrors = {};

    if (!formData.name.trim()) {
      newErrors.name = 'Name is required';
    }

    if (!formData.email.trim()) {
      newErrors.email = 'Email is required';
    } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
      newErrors.email = 'Email is invalid';
    }

    if (!formData.salary) {
      newErrors.salary = 'Salary is required';
    } else if (isNaN(formData.salary) || Number(formData.salary) <= 0) {
      newErrors.salary = 'Salary must be a positive number';
    }

    if (!formData.dateOfBirth) {
      newErrors.dateOfBirth = 'Date of Birth is required';
    }

    if (!formData.mobileNumber) {
      newErrors.mobileNumber = 'Mobile Number is required';
    } else if (!/^\d{10}$/.test(formData.mobileNumber.toString())) {
      newErrors.mobileNumber = 'Mobile Number must be 10 digits';
    }

    if (!formData.departmentId) {
      newErrors.departmentId = 'Department ID is required';
    } else if (isNaN(formData.departmentId) || Number(formData.departmentId) <= 0) {
      newErrors.departmentId = 'Department ID must be a positive number';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!validateForm()) {
      return;
    }

    try {
      setLoading(true);
      
      const employeeData = {
        name: formData.name,
        email: formData.email,
        salary: Number(formData.salary),
        dateOfBirth: formData.dateOfBirth,
        mobileNumber: Number(formData.mobileNumber),
        departmentId: Number(formData.departmentId)
      };

      if (isEditMode) {
        await updateEmployee(id, employeeData);
        alert('Employee updated successfully!');
      } else {
        await createEmployee(employeeData);
        alert('Employee created successfully!');
      }
      
      navigate('/');
    } catch (err) {
      alert(`Failed to ${isEditMode ? 'update' : 'create'} employee`);
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  const handleCancel = () => {
    navigate('/');
  };

  return (
    <div className="container mt-4">
      <div className="row justify-content-center">
        <div className="col-md-8">
          <div className="card shadow">
            <div className="card-header bg-primary text-white">
              <h3 className="mb-0">
                {isEditMode ? 'Edit Employee' : 'Add New Employee'}
              </h3>
            </div>
            <div className="card-body">
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label htmlFor="name" className="form-label">
                    Name <span className="text-danger">*</span>
                  </label>
                  <input
                    type="text"
                    className={`form-control ${errors.name ? 'is-invalid' : ''}`}
                    id="name"
                    name="name"
                    value={formData.name}
                    onChange={handleChange}
                    placeholder="Enter employee name"
                  />
                  {errors.name && <div className="invalid-feedback">{errors.name}</div>}
                </div>

                <div className="mb-3">
                  <label htmlFor="email" className="form-label">
                    Email <span className="text-danger">*</span>
                  </label>
                  <input
                    type="email"
                    className={`form-control ${errors.email ? 'is-invalid' : ''}`}
                    id="email"
                    name="email"
                    value={formData.email}
                    onChange={handleChange}
                    placeholder="Enter email address"
                  />
                  {errors.email && <div className="invalid-feedback">{errors.email}</div>}
                </div>

                <div className="mb-3">
                  <label htmlFor="salary" className="form-label">
                    Salary <span className="text-danger">*</span>
                  </label>
                  <input
                    type="number"
                    className={`form-control ${errors.salary ? 'is-invalid' : ''}`}
                    id="salary"
                    name="salary"
                    value={formData.salary}
                    onChange={handleChange}
                    placeholder="Enter salary"
                  />
                  {errors.salary && <div className="invalid-feedback">{errors.salary}</div>}
                </div>

                <div className="mb-3">
                  <label htmlFor="dateOfBirth" className="form-label">
                    Date of Birth <span className="text-danger">*</span>
                  </label>
                  <input
                    type="date"
                    className={`form-control ${errors.dateOfBirth ? 'is-invalid' : ''}`}
                    id="dateOfBirth"
                    name="dateOfBirth"
                    value={formData.dateOfBirth}
                    onChange={handleChange}
                  />
                  {errors.dateOfBirth && <div className="invalid-feedback">{errors.dateOfBirth}</div>}
                </div>

                <div className="mb-3">
                  <label htmlFor="mobileNumber" className="form-label">
                    Mobile Number <span className="text-danger">*</span>
                  </label>
                  <input
                    type="number"
                    className={`form-control ${errors.mobileNumber ? 'is-invalid' : ''}`}
                    id="mobileNumber"
                    name="mobileNumber"
                    value={formData.mobileNumber}
                    onChange={handleChange}
                    placeholder="Enter 10-digit mobile number"
                  />
                  {errors.mobileNumber && <div className="invalid-feedback">{errors.mobileNumber}</div>}
                </div>

                <div className="mb-3">
                  <label htmlFor="departmentId" className="form-label">
                    Department ID <span className="text-danger">*</span>
                  </label>
                  <input
                    type="number"
                    className={`form-control ${errors.departmentId ? 'is-invalid' : ''}`}
                    id="departmentId"
                    name="departmentId"
                    value={formData.departmentId}
                    onChange={handleChange}
                    placeholder="Enter department ID"
                  />
                  {errors.departmentId && <div className="invalid-feedback">{errors.departmentId}</div>}
                </div>

                <div className="d-flex gap-2">
                  <button
                    type="submit"
                    className="btn btn-primary"
                    disabled={loading}
                  >
                    {loading ? (
                      <>
                        <span className="spinner-border spinner-border-sm me-2"></span>
                        {isEditMode ? 'Updating...' : 'Creating...'}
                      </>
                    ) : (
                      isEditMode ? 'Update Employee' : 'Create Employee'
                    )}
                  </button>
                  <button
                    type="button"
                    className="btn btn-secondary"
                    onClick={handleCancel}
                    disabled={loading}
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default EmployeeForm;
```

Create `src/components/EmployeeForm.css`:
```css
.card {
  border: none;
  border-radius: 10px;
}

.card-header {
  border-radius: 10px 10px 0 0 !important;
  padding: 1.5rem;
}

.card-body {
  padding: 2rem;
}

.form-label {
  font-weight: 600;
  color: #495057;
  margin-bottom: 0.5rem;
}

.form-control {
  border-radius: 5px;
  border: 1px solid #ced4da;
  padding: 0.6rem 0.75rem;
  transition: all 0.3s ease;
}

.form-control:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

.btn {
  padding: 0.6rem 1.5rem;
  border-radius: 5px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}
```

### Step 11: Setup Main App Component with Protected Routes

Update `src/App.jsx`:
```javascript
import React from 'react';
import { Routes, Route } from 'react-router-dom';
import { LoginCallback } from '@okta/okta-react';
import NavBar from './components/NavBar';
import EmployeeList from './components/EmployeeList';
import EmployeeForm from './components/EmployeeForm';
import { RequireAdmin } from './components/SecureRoute';
import './App.css';

function App() {
  return (
    <div className="App">
      <NavBar />
      <Routes>
        <Route path="/" element={<EmployeeList />} />
        <Route path="/login/callback" element={<LoginCallback />} />
        <Route 
          path="/add" 
          element={
            <RequireAdmin>
              <EmployeeForm />
            </RequireAdmin>
          } 
        />
        <Route 
          path="/edit/:id" 
          element={
            <RequireAdmin>
              <EmployeeForm />
            </RequireAdmin>
          } 
        />
      </Routes>
    </div>
  );
}

export default App;
```

**Key Changes**:
- Removed `BrowserRouter` (now in `main.jsx`)
- Added `/login/callback` route for Okta redirect
- Wrapped Add and Edit routes with `RequireAdmin` component
- Employee List remains public (no auth required)

Update `src/App.css`:
```css
.App {
  min-height: 100vh;
  background-color: #f5f5f5;
}
```

### Step 12: Run the Application

Update `src/main.jsx`:
```javascript
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap/dist/js/bootstrap.bundle.min.js';
import './index.css';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

Update `src/index.css`:
```css
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  box-sizing: border-box;
}
```

### Step 11: Update HTML Template

Update `index.html`:
```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Management System</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
```

### Step 12: Run the Application

1. **Install all dependencies**
   ```bash
   npm install
   ```

2. **Start the development server**
   ```bash
   npm run dev
   ```

3. **Access the application**
   - Open your browser and go to `http://localhost:5173`
   - Make sure your backend API is running on `http://localhost:3000`

## API Endpoints Expected

The application expects the following REST API endpoints with JWT authentication:

- `GET /api/employees` - Get all employees (No auth required)
- `GET /api/employees/:id` - Get employee by ID (No auth required)
- `POST /api/employees` - Create new employee (Admin role required, Bearer token)
- `PUT /api/employees/:id` - Update employee (Admin role required, Bearer token)
- `DELETE /api/employees/:id` - Delete employee (Admin role required, Bearer token)

**Authentication Headers**:
```
Authorization: Bearer {access_token}
```

## Key Concepts Covered

1. **React 19 Features**
   - Function components
   - Hooks (useState, useEffect, custom hooks)
   - Component composition
   - Context API (via Okta)

2. **Okta Authentication**
   - OAuth 2.0 with PKCE flow
   - Security component wrapper
   - useOktaAuth hook
   - Protected routes
   - Role-based access control
   - Token management

3. **React Router v6**
   - BrowserRouter
   - Routes and Route
   - useNavigate hook
   - useParams hook
   - Dynamic routing
   - Protected route patterns

4. **API Integration with Auth**
   - Fetch API with Authorization headers
   - JWT token handling
   - Async/await
   - Error handling (401, 403)
   - Loading states

5. **Role-Based Access Control**
   - Group/role checking from Okta claims
   - Conditional rendering based on roles
   - Protected routes for admin-only actions
   - UI adaptation for different user roles

6. **Form Handling**
   - Controlled components
   - Form validation
   - Submit handling with auth
   - Error display

7. **Bootstrap Integration**
   - Responsive design
   - Navigation bar with auth buttons
   - Tables
   - Forms
   - Buttons
   - Cards
   - Alerts

8. **State Management**
   - Component state
   - Authentication state
   - Form state
   - Loading and error states

## Troubleshooting

### Common Issues

1. **Okta Authentication Failed**
   - Verify `.env` file has correct VITE_OKTA_DOMAIN and VITE_OKTA_CLIENT_ID
   - Check redirect URI in Okta app matches `http://localhost:5173/login/callback`
   - Ensure Trusted Origins is configured in Okta for `http://localhost:5173`
   - Clear browser cache and cookies
   - Check browser console for detailed error messages

2. **"Admin role required" Error**
   - Ensure your Okta user is assigned to the "Admin" group
   - Check that groups claim is included in ID token
   - Verify group name spelling matches exactly ("Admin")

3. **API Connection Failed / 401 Unauthorized**
   - Ensure backend server is running on `http://localhost:3000`
   - Check that backend validates Okta JWT tokens correctly
   - Verify backend CORS settings allow Authorization header
   - Check if access token is being sent correctly

4. **Port Already in Use**
   - Change port in `vite.config.js`
   - Or kill the process using port 5173

5. **Module Not Found**
   - Run `npm install` to install all dependencies
   - Clear node_modules and reinstall: `rm -rf node_modules && npm install`

6. **Build Errors**
   - Check for syntax errors in components
   - Ensure all imports are correct
   - Verify Bootstrap and Okta packages are properly installed

## Testing the Application

### Login Flow

1. **Start the Application**
   ```bash
   npm run dev
   ```

2. **View Employee List (No Login Required)**
   - Navigate to `http://localhost:5173`
   - You should see the employee list
   - Note: Add/Edit/Delete buttons are hidden

3. **Login with Okta**
   - Click "Login" in the navigation bar
   - You'll be redirected to Okta login page
   - Enter your Okta credentials
   - After successful login, you'll be redirected back

4. **Test Admin Features**
   - After login, verify user greeting shows your name
   - "Add Employee" link appears in navbar
   - Edit/Delete buttons appear in employee list
   - Click "Add Employee" to create new employee
   - Edit existing employee
   - Delete employee

5. **Logout**
   - Click "Logout" in navigation bar
   - You'll be logged out and redirected to home page
   - Edit/Delete buttons should disappear

### Testing Role-Based Access

**Admin User:**
- Can view employee list
- Can add new employees
- Can edit employees
- Can delete employees
- Sees all action buttons

**Employee User (or not logged in):**
- Can view employee list
- Cannot see Add Employee link
- Cannot see Edit/Delete buttons
- API will return 403 if attempting protected operations

## Learning Objectives

By completing this project, students will learn:
- How to set up a React project with Vite
- Component-based architecture
- React Router v6 for navigation
- Okta OAuth 2.0 authentication integration
- Role-based access control implementation
- Protected routes and conditional rendering
- API integration with REST services and JWT tokens
- Form handling and validation
- Bootstrap for responsive UI
- State management in React
- CRUD operations implementation with authorization

## Next Steps

To enhance this application, consider:
- Adding search and filter functionality
- Implementing pagination
- Adding department management
- Implementing better error handling and user feedback
- Adding loading skeletons
- Adding unit tests with role mocking
- Implementing token refresh logic
- Adding user profile page
- Deploying to production with environment-specific Okta apps

## Container Deployment Files

This project includes the following files for containerization with Podman:

- **`Dockerfile`**: Multi-stage build that compiles the React app and serves it with Nginx
- **`nginx.conf`**: Nginx configuration for serving the React SPA with proper routing
- **`.dockerignore`**: Excludes unnecessary files from the container image
- **`docker-compose.yml`**: Orchestrates frontend and backend containers together

### Docker/Podman Commands Reference

```bash
# Build image
podman build -t ems-react-frontend:latest .

# Run single container
podman run -d -p 8080:80 --name ems-frontend ems-react-frontend:latest

# View logs
podman logs -f ems-frontend

# Stop and remove
podman stop ems-frontend
podman rm ems-frontend

# Using compose (for multi-container setup)
podman-compose up -d
podman-compose down
podman-compose logs -f
```

## Resources

- [React Documentation](https://react.dev/)
- [Vite Documentation](https://vitejs.dev/)
- [React Router Documentation](https://reactrouter.com/)
- [Bootstrap Documentation](https://getbootstrap.com/)
- [Podman Documentation](https://docs.podman.io/)
- [Okta Developer Documentation](https://developer.okta.com/)

---

**Happy Coding! ðŸš€**
